log_level  = "info"
log_format = "logfmt"

remote "http" "example-password" {
  url     = "http://localhost:12345/mock/some-password"
  refresh = "10s"

  // State:
  // content = <HTTP response body>
}

// Each metrics_forwarder is implemented as a WAL + zero or more remote_writes.
metrics_forwarder "default" {
  external_labels = {
    cluster = "flow-demo"
  }

  remote_write {
    url = "http://localhost:9009/api/prom/push"

    basic_auth {
      username = "helloworld"
      password = remote.http.example-password.content
    }
  }

  // State:
  // receiver = <value where metrics can be sent>
}

// Discover some Prometheus targets.
discovery "static" "self" {
  hosts  = ["localhost:12345"]
  labels = { app = "agentflow" }

  // State:
  // targets = <array of discovered targets>
}

// Launch an integration.
integration "github" "default" {
  repositories = [
    "rfratto/viceroy",
  ]

  // State:
  // targets = <array of generated targets>
}

// Scrape metrics from both our discovery and integrations.
metrics_scraper "default" {
  targets = concat(
    discovery.static.self.targets,
    integration.github.default.targets,
  )
  send_to = metrics_forwarder.default.receiver

  scrape_interval = "60s"
  scrape_timeout  = "10s"

  // State: <none>
}
